---
layout: post
categories: 程序设计
tags: [C/C++, 类型]
---

这里仅讨论**函数**相关的复杂类型的解读。

## 一、嵌在对象定义中的函数类型
有如下函数签名：
```C
int f(int x, int fn(int));
```
其中参数`fn`的声明比较复杂：
```C
int fn(int)
```
对`fn`类型的解读步骤如下：
1. 找到`fn`附近的修饰符。

    `fn`左侧没有修饰符，右侧有`()`。因此，`fn`就是一个**函数**对象。

2. 去掉对象名。

    剩下的是：
    <div style="font-size: 1.2rem; font-weight: bold;">int (int)</div>

    这就是函数`fn`的类型。

3. 得出结论

    综上，对象`fn`就是一个**函数**；它的签名具有这样的特征：
    - 带有一个参数，这个参数的类型是`int`。
    - 函数返回值类型为`int`。

## 二、嵌在对象定义中的函数指针类型
有如下函数签名：
```C
int f(int x, int (*pf)(int));
```
其中参数`pf`的声明比较复杂：
```C
int (*pf)(int)
```
对`pf`类型的解读步骤如下：
1. 找到`pf`附近的修饰符。
    
    `pf`左侧有修饰符`*`，并且和`pf`一起括在`()`中。这对`()`提升了`*`的优先级，因此`*`先和`pf`结合。这样，无论如何，`pf`就是一个**指针**对象。

2. 去掉对象名及其就近的修饰符。

    剩下的是：
    <div style="font-size: 1.2rem; font-weight: bold;">int (int)</div>

    这就是指针`pf`的基类型。很明显，这是一种函数类型。

3. 得出结论

    综上，对象`pf`就是一个**指向函数**的**指针对象**；它指向的函数签名具有这样的特征：
    - 带有一个参数，这个参数的类型是`int`。
    - 函数返回值类型为`int`。

## 三、与函数定义的对比
将上述`fn`、`pf`的定义和如下定义对比：
```C
int *fn(int);
```
解读步骤一样：
1. 找到`fn`附近的修饰符。
    
    `fn`左侧有修饰符`*`，右侧有`()`。由于`()`的优先级高于`*`的，因此`fn`先和`()`结合。这样，无论如何，`fn`就是一个**函数**对象，即`fn`是函数名。

2. 去掉函数名。

    剩下的是：
    <div style="font-size: 1.2rem; font-weight: bold;">int *(int)</div>

    这就是函数`fn`的类型。
    - `()`中的是函数的参数列表。这里，是一个整型参数。
    - `()`左侧的是函数返回值类型。这里是`int*`。因此，函数`fn`要返回整型指针类型。

3. 得出结论

    综上，对象`fn`就是一个**函数**对象；它具有这样的特征：
    - 带有一个参数，这个参数的类型是`int`。
    - 函数返回值类型为整型指针`int*`。
